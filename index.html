<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>切手カウンター（複合額面・空白スタート）</title>
<style>
:root { --radius: 10px; }
* { box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
               "Hiragino Kaku Gothic ProN", "Noto Sans JP", Arial, sans-serif;
  margin: 14px;
}

h1 { font-size: 20px; margin: 0 0 8px; }
.hint { color:#666; font-size: 13px; margin-bottom: 12px; }

.toolbar { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
.toolbar button {
  padding: 8px 14px;
  border-radius: var(--radius);
  border: 1px solid #ccc;
  background: #fff;
  font-size: 14px;
  cursor: pointer;
}
.toolbar button.primary {
  background: #000; color: #fff; border: none;
}

.sectionTitle { margin: 12px 0 6px; font-weight: bold; }
.chips { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px; }
.chips button {
  padding: 6px 10px;
  border: 1px solid #ccc;
  border-radius: 16px;
  background: #fff;
  font-size: 14px;
  cursor: pointer;
}

table { width: 100%; border-collapse: collapse; }
th, td { text-align: center; padding: 4px; }
td { vertical-align: middle; }

.amount-wrap { display:inline-flex; align-items:center; gap:4px; }
.amount-wrap .amount { width: 80px; flex: 0 0 auto; }

.plus-btn {
  width: 34px; height: 34px;
  border-radius: 8px;
  font-size: 18px;
  display:inline-flex; align-items:center; justify-content:center;
  border:1px solid #ccc; background:#fff; cursor:pointer;
}

input[type="number"], input[type="text"] {
  padding: 6px 8px;
  font-size: 15px;
  border-radius: var(--radius);
  border: 1px solid #ccc;
  text-align: center;
}

.delete-btn {
  padding: 4px 8px;
  border: none;
  background: #f66;
  color: #fff;
  border-radius: var(--radius);
  cursor: pointer;
}

.details, .total { margin-top: 12px; padding: 8px; border: 1px solid #ccc; border-radius: var(--radius); }
.details { font-size: 14px; text-align: left; }
.total { font-weight: bold; font-size: 16px; text-align: right; }

@media (max-width: 480px) {
  .amount-wrap .amount { width: 72px; }
  .plus-btn { width: 32px; height: 32px; font-size: 17px; }
  input[type="number"], input[type="text"] { font-size: 15px; }
}
</style>
</head>
<body>

<h1>切手カウンター（複合額面・空白スタート）</h1>
<div class="hint">
額面は「20」だけでなく <b>20+100</b> のように＋で合算できます。<br>
枚数（シート内）が空白/0 の時は 額面×シート数or枚数 で計算。下に明細を自動表示します。
</div>

<div class="toolbar">
  <button id="addRow">行を追加</button>
  <button id="clearAll">全てクリア</button>
  <button id="shareBtn" class="primary">結果を共有/コピー</button>
</div>

<div class="sectionTitle">よく使う額面</div>
<div class="chips" id="chips">
  <button>1</button><button>2</button><button>5</button><button>10</button>
  <button>20</button><button>30</button><button>50</button>
</div>

<table id="stampTable">
  <thead>
    <tr>
      <th>額面（円, 例: 20 または 20+100）</th>
      <th>枚数（シート内）</th>
      <th>小計</th>
      <th>行</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="details" id="details">(ここに計算式が表示されます)</div>
<div class="total" id="total">合計 0 円</div>

<script>
const tableBody = document.querySelector('#stampTable tbody');
const detailsDiv = document.getElementById('details');
const totalDiv = document.getElementById('total');

function addRow(amountVal = '', qtyVal = '') {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td>
      <div class="amount-wrap">
        <input type="text" class="amount" value="${amountVal}" placeholder="20 または 20+100">
        <button class="plus-btn">+</button>
      </div>
    </td>
    <td><input type="number" class="qty" value="${qtyVal}" min="0"></td>
    <td class="subtotal">0 円</td>
    <td><button class="delete-btn">削除</button></td>
  `;
  tableBody.appendChild(tr);
  updateAll();

  tr.querySelector('.delete-btn').addEventListener('click', () => { tr.remove(); updateAll(); });
  tr.querySelector('.plus-btn').addEventListener('click', () => {
    const amtInput = tr.querySelector('.amount');
    if (amtInput.value && !amtInput.value.endsWith('+')) {
      amtInput.value += '+';
    }
    amtInput.focus();
  });
  tr.querySelectorAll('input').forEach(inp => inp.addEventListener('input', updateAll));
}

function parseAmount(str) {
  return str.split('+').map(s => parseFloat(s) || 0).reduce((a,b) => a+b, 0);
}

function updateAll() {
  let total = 0;
  let details = [];
  tableBody.querySelectorAll('tr').forEach(tr => {
    const amountStr = tr.querySelector('.amount').value.trim();
    const qty = parseFloat(tr.querySelector('.qty').value) || 0;
    const amount = parseAmount(amountStr);
    const subtotal = amount * qty;
    tr.querySelector('.subtotal').textContent = subtotal.toLocaleString() + ' 円';
    if (amountStr) {
      const display = amountStr.includes('+') ? `(${amountStr})×${qty}` : `${amountStr}×${qty}`;
      details.push(`${display} = ${subtotal.toLocaleString()}`);
    }
    total += subtotal;
  });
  detailsDiv.textContent = details.length ? details.join('　') : '(ここに計算式が表示されます)';
  totalDiv.textContent = '合計 ' + total.toLocaleString() + ' 円';
}

document.getElementById('addRow').addEventListener('click', () => addRow());
document.getElementById('clearAll').addEventListener('click', () => { tableBody.innerHTML = ''; updateAll(); });
document.getElementById('chips').addEventListener('click', e => {
  if (e.target.tagName === 'BUTTON') {
    addRow(e.target.textContent);
  }
});
document.getElementById('shareBtn').addEventListener('click', () => {
  const text = totalDiv.textContent + '\n' + detailsDiv.textContent;
  navigator.clipboard.writeText(text).then(() => alert('コピーしました'));
});

addRow();
</script>

</body>
</html>
