<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>切手カウンター（複合額面・空白スタート）</title>
<style>
body {
    font-family: sans-serif;
    margin: 20px;
}

input[type="number"], input[type="text"] {
    padding: 6px;
    font-size: 16px;
}

.plus-btn {
    font-size: 24px;      /* ボタンの文字サイズ */
    padding: 8px 14px;    /* ボタン内の余白 */
    margin-left: 6px;     /* 額面入力との間隔 */
    cursor: pointer;
    background-color: #4CAF50; /* 緑色 */
    color: white;
    border: none;
    border-radius: 6px;
}

.plus-btn:hover {
    background-color: #45a049;
}
</style>
</head>
<body>

<h2>切手カウンター（複合額面・空白スタート）</h2>
<p>額面は「20」だけでなく 20+100 のように＋で合算できます。枚数（シート内）が空白/0のときは「額面×シート数or枚数」で計算。下に明細テキストを自動表示します。</p>

<div id="rows"></div>

<button onclick="addRow()">行を追加</button>
<button onclick="clearAll()">全てクリア</button>
<button onclick="shareResult()">結果を共有/コピー</button>

<h3>よく使う額面（編集可）</h3>
<div id="commonValues"></div>
<button onclick="editCommonValues()">編集</button>

<h3>明細</h3>
<pre id="details"></pre>
<h3>合計 <span id="total">0</span> 円</h3>

<script>
let commonValues = ["20", "50", "82", "100", "120", "500"];

function addRow(value="") {
    const div = document.createElement("div");
    div.innerHTML = `
        額面（円）:
        <input type="text" value="${value}" onchange="update()">
        <button class="plus-btn" onclick="appendPlus(this)">＋</button>
        枚数:
        <input type="number" min="0" onchange="update()">
        シート数 or 枚数:
        <input type="number" min="0" onchange="update()">
        小計: <span>0</span> 円
    `;
    document.getElementById("rows").appendChild(div);
}

function appendPlus(btn) {
    const input = btn.previousElementSibling;
    input.value += (input.value ? "+" : "") ;
    input.focus();
}

function update() {
    let total = 0;
    let details = "";
    const rows = document.querySelectorAll("#rows > div");
    rows.forEach(row => {
        const inputs = row.querySelectorAll("input");
        const faceValueStr = inputs[0].value.trim();
        const count = parseInt(inputs[1].value) || 0;
        const sheets = parseInt(inputs[2].value) || 0;
        if (!faceValueStr) {
            row.querySelector("span").textContent = 0;
            return;
        }
        const faceValue = faceValueStr.split("+").reduce((sum, v) => sum + (parseInt(v) || 0), 0);
        const quantity = count || sheets;
        const subtotal = faceValue * quantity;
        row.querySelector("span").textContent = subtotal;
        total += subtotal;
        if (quantity > 0) {
            details += `${faceValueStr}円 × ${quantity}枚 = ${subtotal}円\n`;
        }
    });
    document.getElementById("total").textContent = total;
    document.getElementById("details").textContent = details;
}

function clearAll() {
    document.getElementById("rows").innerHTML = "";
    update();
}

function shareResult() {
    navigator.clipboard.writeText(document.getElementById("details").textContent)
        .then(() => alert("コピーしました"));
}

function editCommonValues() {
    const input = prompt("よく使う額面をカンマ区切りで入力", commonValues.join(","));
    if (input !== null) {
        commonValues = input.split(",").map(v => v.trim());
        renderCommonValues();
    }
}

function renderCommonValues() {
    const div = document.getElementById("commonValues");
    div.innerHTML = "";
    commonValues.forEach(v => {
        const btn = document.createElement("button");
        btn.textContent = v;
        btn.onclick = () => addRow(v);
        div.appendChild(btn);
    });
}

renderCommonValues();
</script>

</body>
</html>
